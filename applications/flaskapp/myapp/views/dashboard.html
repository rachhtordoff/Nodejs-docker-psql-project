
<% include partials/base.ejs %>

    <head>
      <%if (type == "coach") { %>
      <% include partials/coachheader.ejs %>
      <% } else if (type == "client") { %>
          <% include partials/clientheader.ejs %>
      <% }%>

</head>
<body>
<h2> hi <%= username %></h2>
<h3>Message Stats</h3>
<div class="row">
  <div class="col-md-3">
<div class="panel panel-default">
  <div class="panel-body">
    <div class="row">
      <div class="col-md-6">
<b>  Messages sent</b>
</div>
  <div class="col-md-6"><div id="textsent"> </div>
</div>
</div>
  </div>
</div>
</div>
<div class="col-md-3">
<div class="panel panel-default">
<div class="panel-body">
  <p id="textreceived" style="text-align:center;"> </p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="panel panel-default">
<div class="panel-body">
  <p id="texttotal" style="text-align:center;"> </p>
</div>
</div>
</div>
</div>

<h3>Here are your events </h3>
<div class="events" id="eventlist">
  <div class="event-container" style="margin-top:20px;">
  <b><u><p id="event-title" > </p></u></b>
  <p id="event-note"> </p>
  </div>
</div>

<input name="username" id="username" value= <%= username %> hidden>
<input name="id" id="id" value= <%= id %> hidden>

</body>

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

var socket = io();
var username = $('#username').val();
var id = $('#id').val();
console.log(id);
var messages = document.getElementById('textsent');
var messagesrec = document.getElementById('textreceived');
var messagestotal = document.getElementById('texttotal');
var eventtitle = document.getElementById('event-title');
var eventnote = document.getElementById('event-note');
socket.emit('user capture', username, id, 0);
socket.on('userdetails', function(body){
  console.log(body);
  var json = JSON.parse(body);
  messages.innerHTML = (json[0]['count']);
});

socket.on('details', function(body){
  var json = JSON.parse(body);
  messages.innerHTML = (json[0]['count']);
  console.log(body);
});
socket.on('events', function(body){
  console.log(body);
  var json = JSON.parse(body);
    for(var i=0; i < json.length; i++){
    var title = (json[i]['title']);
    var note = (json[i]['note']);
    var d = document.createElement( 'div' );
    d.id = "new1";
    d.innerHTML = title + ": " + note;
    var p = document.getElementById('eventlist');
    p.appendChild(d);
  }
});

socket.on('eventsuccess', function(receiver_id, user_id, note, title, date){
  var s = document.createElement( 'div' );
  s.id = "new1";
  s.innerHTML = title + note;
  var p = document.getElementById('eventlist');
  p.appendChild(s);
});

</script>
