
<% include partials/base.ejs %>

    <head>
      <%if (type == "coach") { %>
      <% include partials/coachheader.ejs %>
      <% } else if (type == "client") { %>
          <% include partials/clientheader.ejs %>
      <% }%>

</head>
<body>
</br>

<input name="username" id="username" value= <%= username %> hidden>
<input name="id" id="id" value= <%= id %> hidden>
<h5>Message Stats</h5>

<div class="row">
  <div class="col s4">
    <div class="card-panel teal">
      <span class="white-text">
        <div class="row">
          <div class="col s8 ">
            Messages sent:
          </div>
              <div class="col s4 ">
              <div id="textsent"> </div>
              </div>
          </div>
        </span>
    </div>
  </div>
  <div class="col s4">
    <div class="card-panel teal">
      <span class="white-text">
        <div class="row">
          <div class="col s8 ">
            Messages received:
          </div>
              <div class="col s4 ">
                <div id="textreceived" style="text-align:center;"> </div>
              </div>
          </div>
        </span>
    </div>
  </div>
  <div class="col s4">
    <div class="card-panel teal">
      <span class="white-text">
        <div class="row">
          <div class="col s8 ">
            Total messages:
          </div>
              <div class="col s4 ">
                <div id="texttotal" style="text-align:center;"> </div>
              </div>
          </div>
        </span>
    </div>
  </div>
</div>

<h5>Here are your events </h5>


  <table>
      <thead>
        <tr>
            <th data-field="id">Title</th>
            <th data-field="name">description</th>
            <th data-field="price">Date</th>
            <th data-field="price">Attendees</th>

        </tr>
      </thead>
    </table>
      <div class="scroll-container" style="  height: 300px;overflow-y: scroll;">
<table>
  <tbody id="eventlist">
      <% for(var i=0; i < json.length; i++) { %>

          <tr>
           <td><%= json[i]['title'] %></td>
           <td><%= json[i]['note'] %></td>
           <td>Alvin</td>
           <td>Eclair</td>
         </tr>

      <% } %>
      </tbody>
    </table>
    </div>

</div>


</body>



<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

var socket = io();
var username = $('#username').val();
var id = $('#id').val();
console.log(id);
var messages = document.getElementById('textsent');
var messagesrec = document.getElementById('textreceived');
var messagestotal = document.getElementById('texttotal');

socket.emit('user capture', username, id, 0);
socket.on('userdetails', function(body){
  console.log(body);
  var json = JSON.parse(body);
  messages.innerHTML = (json[0]['count']);
});

socket.on('details', function(body){
  var json = JSON.parse(body);
  messages.innerHTML = (json[0]['count']);
  console.log(body);
});
socket.on('updatereceived', function(body){
  var json = JSON.parse(body);
  messagesrec.innerHTML = (json[0]['count']);
  console.log(body);
});
socket.on('updateall', function(body){
  var json = JSON.parse(body);
  messagestotal.innerHTML = (json[0]['count']);
  console.log(body);
});

socket.on('all messages', function(body){
  var json = JSON.parse(body);
  messagestotal.innerHTML = (json[0]['count']);
  console.log(body);
});
socket.on('received messages', function(body){
  var json = JSON.parse(body);
  messagesrec.innerHTML = (json[0]['count']);
  console.log(body);
});


socket.on('eventsuccess', function(receiver_id, user_id, note, title, date){
  var p = document.getElementById('eventlist');
  console.log(receiver_id);
p.innerHTML += (  '<tbody><tr><td>' + title + '</td><td>' + title + '</td><td>Alvin</td><td>Eclair</td></tr></tbody>');

});

</script>

<% include partials/footer.ejs %>
