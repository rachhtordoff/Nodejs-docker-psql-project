
<% include partials/base.ejs %>

<head>
  <%if (id == "1") { %>
  <% include partials/coachheader.ejs %>
  <% } else if (id == "2") { %>
      <% include partials/clientheader.ejs %>
  <% }%>


<body>
<h2><%= username %>'s messages</h2>


</br>
<div class="row">
  <div class="col s7 ">
    <div class="scroll-container" style="  height: 300px;overflow-y: scroll;">
<table class="bordered">
    <tbody id="eventlist">
    <% for(var i=0; i < json.length; i++) { %>
        <tr>
         <td><%= json[i]['sender_id'] %></td>
         <td><%= json[i]['message'] %></td>
       </tr>
    <% } %>
    </tbody>
  </table>
  </div>
</div>

<input name="username" id="username" value= <%= username %> hidden>
<input name="id" id="id" value= <%= id %> hidden>
<input name="receiver" id="receiver" value= <%= receiver_id %> hidden>
<div class="col s4 " style="border-left:solid black 1px;">
  <h5> New message </h5>
<form id="form" id="chat_form">
    <input id="chat_input" type="text">
    <input type="submit" id="send" value="Send">
</form>
</div>
</div>
 <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="/socket.io/socket.io.js"></script>
</body>
</html>

<script>

var socket = io();
var username = $('#username').val();
var id = $('#id').val();
console.log(id);
var receiverid = $('#receiver').val();
console.log(receiverid);
socket.emit('user capture', username, id, receiverid);
socket.on('connection', function(connection){
  var json = JSON.parse(connection);

  //COME BACK TO HERE AND LOOP OUT LIST OF MESSAGES IN ORDER
//  myTextArea.innerHTML += (json[0]['message']);
});

$('form').submit(function(){
socket.emit('chat message', id, receiverid, $('#chat_input').val());
$('#chat_input').val('');
$('#username').val('');
return false;
});

socket.on('success', function(id, message){
  var p = document.getElementById('eventlist');
  p.innerHTML += ('<tbody><tr><td>' + id +  '</td><td>' + message + '</td></tr></tbody>');
  console.log(id+message);
});






</script>
<% include partials/footer.ejs %>
